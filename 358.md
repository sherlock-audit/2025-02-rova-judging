Overt Burgundy Marmot

Medium

# CancelParticipationRequest and ClaimRefundRequest share the same signature

### Summary

According to the `README`, the expected behavior should be as follows:

- User selects payment currency and token amount in Rova frontend, which sends a request to Rova backend to validate the participation request and generate the signature.
- Backend verifies that the user is allowed to initiate the request and performs preliminary validation on request parameters
- Backend generates signature for user if validation passes
- User submits transaction including the signature, which is then verified in the contract to make sure the signature is valid and generated by a member of the signer role.

### Root Cause

The issue is that both `CancelParticipationRequest` and `ClaimRefundRequest` share the same signature, meaning the backend would validate both actions interchangeably.

```solidity
struct CancelParticipationRequest {
    uint256 chainId;
    bytes32 launchId;
    bytes32 launchGroupId;
    bytes32 launchParticipationId;
    bytes32 userId;
    address userAddress;
    uint256 requestExpiresAt;
}


struct ClaimRefundRequest {
    uint256 chainId;
    bytes32 launchId;
    bytes32 launchGroupId;
    bytes32 launchParticipationId;
    bytes32 userId;
    address userAddress;
    uint256 requestExpiresAt;
}
```

https://github.com/sherlock-audit/2025-02-rova/blob/main/rova-contracts/src/Types.sol#L108-L116

https://github.com/sherlock-audit/2025-02-rova/blob/main/rova-contracts/src/Launch.sol#L485

https://github.com/sherlock-audit/2025-02-rova/blob/main/rova-contracts/src/Launch.sol#L418

### Internal Pre-conditions

1. `finalizesAtParticipation == false`

### External Pre-conditions

None

### Attack Path

1. The user calls `Launch::participate`.

2. The user requests a signature for `Launch::cancelParticipation`.

3. The user loses in `Launch::finalizeWinners`.

4. The user **becomes ineligible due to backend checks** but already possesses a valid signature to call `Launch::claimRefund`.

### Impact

The user can bypass certain backend checks with valid signatures across multiple contract calls.

### PoC

_No response_

### Mitigation

Use `msg.sig` as part of the signature validation check.