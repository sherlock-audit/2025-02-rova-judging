Salty Seafoam Turkey

Medium

# Missing chain ID and contract address in `rova_sale::fund` signature verification leads to replay attacks

### Summary

The missing chain ID and contract address in the signature message will cause a potential replay attack for users as an attacker can reuse signatures on different networks or contracts.

```move
    public entry fun fund(
        user: &signer,
        signature_bytes: vector<u8>,
        public_key_bytes: vector<u8>,
        launch_participation_id: vector<u8>,
        token_amount: u64,
        payment_amount: u64
    ) acquires SaleConfig, Roles {
        ...
        // Verify signature
        let signature = ed25519::new_signature_from_bytes(signature_bytes);
        let unvalidated_public_key = ed25519::new_unvalidated_public_key_from_bytes(public_key_bytes);
        let message = vector::empty<u8>();
        vector::append(&mut message, bcs::to_bytes(&user_addr));
        vector::append(&mut message, bcs::to_bytes(&payment_amount));
        vector::append(&mut message, bcs::to_bytes(&token_amount));
        vector::append(&mut message, bcs::to_bytes(&launch_participation_id));

        assert!(
            ed25519::signature_verify_strict(
                &signature,
                &unvalidated_public_key,
                message
            ),
            error::invalid_argument(EINVALID_SIGNATURE)
        );
```
### Root Cause

In [rova_sale.move#L149-L165](https://github.com/sherlock-audit/2025-02-rova/blob/main/rova-movement-contracts/sources/rova_sale.move#L149-L165) there is no inclusion of chain ID and contract address in the signed message.

### Internal Pre-conditions

1. A valid signature is generated by backend for `rova_sale::fund` without embedding the target chain ID and contract address.
2. The sale is active and not paused, allowing `fund` to accept signatures.


### External Pre-conditions

None

### Attack Path

1. User use a valid signature for ``rova_sale::fund` on the intended chain, providing `signature_bytes`, `public_key_bytes`, and other parameters.
2. Attacker replays the same signature on a different chain or contract because there is no chain-specific or contract-specific data in the signature.
3. The contract accepts the signature, allowing an unintended fund operation to proceed.

Note:  It could be a replay of a signature from testnet transactions as well. 

### Impact

- Users could experience unintended repeated usage of their signatures across multiple contracts or chains, which might allow attackers to deposit the same `payment_amount` or claim tokens in unexpected contexts.
- The protocol could face confusion or loss of accurate accounting due to multiple replays of the same signature across different environments.



### PoC

_No response_

### Mitigation

Include both chain ID and contract address in the signed message.